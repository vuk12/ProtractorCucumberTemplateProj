"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ErrorSerialiser = void 0;
const serenitySpecificErrors = require("../errors");
const json_1 = require("./json");
class ErrorSerialiser {
    static serialise(error) {
        const serialisedError = Object.getOwnPropertyNames(error).reduce((serialised, key) => {
            serialised[key] = error[key];
            return serialised;
        }, { name: error.constructor.name || error.name });
        return (0, json_1.stringify)(serialisedError);
    }
    static deserialise(stringifiedError) {
        const serialisedError = (0, json_1.parse)(stringifiedError);
        const constructor = ErrorSerialiser.recognisedErrors.find(errorType => errorType.name === serialisedError.name) || Error;
        const deserialised = Object.create(constructor.prototype);
        for (const property in serialisedError) {
            if (Object.prototype.hasOwnProperty.call(serialisedError, property)) {
                deserialised[property] = serialisedError[property];
            }
        }
        return deserialised;
    }
    static deserialiseFromStackTrace(stack) {
        const stackTracePattern = /^([^\s:]*Error).*?(?::\s)?(.*?)\n(^ +at.*)$/ms;
        if (!stackTracePattern.test(stack)) {
            return new Error(String(stack));
        }
        const [, name, message, callStack_] = stack.match(stackTracePattern);
        return ErrorSerialiser.deserialise((0, json_1.stringify)({ name, message: message.trim(), stack }));
    }
}
exports.ErrorSerialiser = ErrorSerialiser;
ErrorSerialiser.recognisedErrors = [
    ...Object.keys(serenitySpecificErrors).map(key => serenitySpecificErrors[key]),
    Error,
    EvalError,
    RangeError,
    ReferenceError,
    SyntaxError,
    TypeError,
    URIError,
];
//# sourceMappingURL=ErrorSerialiser.js.map